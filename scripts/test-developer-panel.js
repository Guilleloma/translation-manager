#!/usr/bin/env node

/**
 * Script de prueba para el panel de developer
 * Valida la detección de slugs auto-generados y la generación de sugerencias
 */

const { testCases, expectedSuggestions, isSlugAutoGenerated, generateSuggestedSlug } = require('../src/app/developer/test-data.ts');

console.log('🧪 Ejecutando pruebas del Panel de Developer\n');

// Test 1: Validar detección de slugs auto-generados
console.log('📋 Test 1: Detección de slugs auto-generados');
let passedTests = 0;
let totalTests = testCases.length;

testCases.forEach((testCase, index) => {
  const result = isSlugAutoGenerated(testCase.slug, testCase.text);
  const passed = result === testCase.expected;
  
  console.log(`  ${passed ? '✅' : '❌'} Test ${index + 1}: ${testCase.description}`);
  console.log(`     Slug: "${testCase.slug}" → ${result ? 'Auto-generado' : 'Válido'}`);
  
  if (passed) {
    passedTests++;
  } else {
    console.log(`     ❌ Esperado: ${testCase.expected}, Obtenido: ${result}`);
  }
});

console.log(`\n📊 Resultado Test 1: ${passedTests}/${totalTests} pruebas pasaron\n`);

// Test 2: Validar generación de sugerencias
console.log('📋 Test 2: Generación de sugerencias de slug');
let passedSuggestions = 0;
let totalSuggestions = expectedSuggestions.length;

expectedSuggestions.forEach((testCase, index) => {
  const result = generateSuggestedSlug(testCase.text);
  const passed = result === testCase.expected;
  
  console.log(`  ${passed ? '✅' : '❌'} Sugerencia ${index + 1}:`);
  console.log(`     Texto: "${testCase.text}"`);
  console.log(`     Sugerencia: "${result}"`);
  
  if (passed) {
    passedSuggestions++;
  } else {
    console.log(`     ❌ Esperado: "${testCase.expected}", Obtenido: "${result}"`);
  }
});

console.log(`\n📊 Resultado Test 2: ${passedSuggestions}/${totalSuggestions} sugerencias correctas\n`);

// Resumen final
const totalPassed = passedTests + passedSuggestions;
const totalTotal = totalTests + totalSuggestions;

console.log('🎯 RESUMEN FINAL:');
console.log(`   Total de pruebas: ${totalTotal}`);
console.log(`   Pruebas exitosas: ${totalPassed}`);
console.log(`   Tasa de éxito: ${Math.round((totalPassed / totalTotal) * 100)}%`);

if (totalPassed === totalTotal) {
  console.log('\n🎉 ¡Todas las pruebas pasaron! El panel de developer está listo.');
  process.exit(0);
} else {
  console.log('\n⚠️  Algunas pruebas fallaron. Revisar la implementación.');
  process.exit(1);
}
